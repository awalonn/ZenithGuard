(function(){"use strict";window.ZenithGuardToastUtils=window.ZenithGuardToastUtils||{};const G=({message:g,type:e="success",duration:n=3e3,id:t=null})=>{let i=document.getElementById("zg-toast-container");if(i||(i=document.createElement("div"),i.id="zg-toast-container",document.body.appendChild(i)),t){const p=document.getElementById(t);p&&p.remove()}const o=document.createElement("div");t&&(o.id=t),o.className=`zg-toast zg-toast-${e}`;const l={success:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" /></svg>',error:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z" clip-rule="evenodd" /></svg>',loading:'<div class="zg-toast-spinner"></div>',info:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" /></svg>'}[e]||"";o.innerHTML=`${l}<span>ZenithGuard: ${g}</span>`,i.appendChild(o),n>0&&setTimeout(()=>{o.classList.add("hiding"),o.addEventListener("animationend",()=>o.remove(),{once:!0})},n)};window.ZenithGuardToastUtils={showToast:G},window.ZenithGuardSelectorGenerator=(()=>{function g(t){if(!t)return null;if(t.id&&n(t.id)){const o=`#${CSS.escape(t.id)}`;if(document.querySelectorAll(o).length===1)return o}const i=["data-testid","data-cy","data-test-id","role","name"];for(const o of i){const r=t.getAttribute(o);if(r&&n(r)){const l=`${t.tagName.toLowerCase()}[${o}="${CSS.escape(r)}"]`;if(document.querySelectorAll(l).length===1)return l}}if(t.className&&typeof t.className=="string"){const r=t.className.trim().split(/\s+/).filter(l=>n(l)&&!l.includes(":"));if(r.length>0){const l=t.tagName.toLowerCase()+"."+r.map(p=>CSS.escape(p)).join(".");if(document.querySelectorAll(l).length===1)return l}}return e(t)}function e(t){if(!t||t.nodeType!==Node.ELEMENT_NODE)return null;const i=t;if(i.tagName.toLowerCase()==="body")return"body";if(i.tagName.toLowerCase()==="html")return"html";if(i.id&&n(i.id))return`#${CSS.escape(i.id)}`;const o=e(i.parentElement);if(!o)return null;const r=Array.from(i.parentElement.children),l=i.tagName.toLowerCase(),p=r.filter(f=>f.tagName.toLowerCase()===l);if(p.length===1)return`${o} > ${l}`;const v=p.indexOf(i)+1;return`${o} > ${l}:nth-of-type(${v})`}function n(t){return!(!t||/^\d+$/.test(t)||t.length>50)}return{generate:g}})(),window.ZenithGuardInspector=(()=>{const g=c=>{window.ZenithGuardToastUtils&&window.ZenithGuardToastUtils.showToast?window.ZenithGuardToastUtils.showToast(c):console.warn("ZenithGuard: Toast utility not found. Please reload the extension.")};let e=!1,n=null,t=null,i=null,o=[],r=null,l=null;async function p(c){if(!e){e=!0,l=c;try{const u=await chrome.runtime.sendMessage({type:"GET_NETWORK_LOG"});Array.isArray(u)?o=u:o=[]}catch(u){console.error("ZenithGuard Inspector: Could not fetch network log.",u),o=[]}f(),b(),g({message:"Inspector active. Use buttons to hide/block. Press ESC to exit."})}}function v(){e&&(e=!1,l=null,r&&clearTimeout(r),E(),a())}function f(){n=document.createElement("div"),n.id="zg-inspector-highlight",t=document.createElement("div"),t.id="zg-inspector-hud",t.innerHTML=`
            <div class="zg-hud-header">
                <div class="zg-hud-selector" title="No element selected"></div>
                <div class="zg-hud-header-actions">
                    <button class="zg-hud-btn zg-hud-quick-hide-btn">Quick Hide</button>
                    <button class="zg-hud-btn zg-hud-ai-hide-btn">Advanced Hide (AI)</button>
                </div>
            </div>
            <div class="zg-hud-body">
                <div class="zg-hud-requests">
                    <h4>Associated Requests</h4>
                    <div class="zg-hud-request-list"></div>
                </div>
            </div>
            <div class="zg-hud-footer">
                <span class="zg-hud-exit-hint">Hover to select. Use buttons to hide or block. ESC to exit.</span>
            </div>
        `,document.body.appendChild(n),document.body.appendChild(t)}function E(){t?.remove(),n?.remove(),n=null,t=null}function b(){t?.addEventListener("mouseenter",h),t?.addEventListener("click",d,!0),document.addEventListener("mouseover",s,!0),document.addEventListener("keydown",m,!0)}function a(){t?.removeEventListener("mouseenter",h),t?.removeEventListener("click",d,!0),document.removeEventListener("mouseover",s,!0),document.removeEventListener("keydown",m,!0)}function s(c){r&&clearTimeout(r),r=setTimeout(()=>{y(c.target)},120)}function h(){r&&clearTimeout(r)}function d(c){c.preventDefault(),c.stopPropagation();const u=c.target;if(u.classList.contains("zg-hud-block-btn")){const w=u;if(!w.disabled){const L=w.dataset.domain;if(!L)return;w.disabled=!0,chrome.runtime.sendMessage({type:"ADD_TO_NETWORK_BLOCKLIST",domain:L}).then(A=>{A&&A.success?(w.textContent="Blocked!",g({message:`${L} added to blocklist.`})):(w.disabled=!1,g({message:A.message||`Could not block ${L}.`,type:"error"}))}).catch(A=>{w.disabled=!1,console.warn("ZenithGuard Inspector: Could not send block message.",A),g({message:"Error communicating with extension.",type:"error"})})}}else if(u.classList.contains("zg-hud-quick-hide-btn")&&"disabled"in u&&!u.disabled){const w=u;if(i&&l){const L=window.ZenithGuardSelectorGenerator.generate(i);L?(l(L),w.textContent="Hidden!",w.disabled=!0,setTimeout(()=>{e&&w&&(w.textContent="Quick Hide",w.disabled=!1)},1500)):g({message:"Could not generate a unique selector.",type:"error"})}}else if(u.classList.contains("zg-hud-ai-hide-btn")&&i){const w={tag:i.tagName.toLowerCase(),text:i.textContent?.trim().replace(/\s+/g," ").substring(0,200)||""};l&&window.ZenithGuardAIHider.start(L=>l(L),w),v()}}function m(c){c.key==="Escape"&&v()}function y(c){if(!e||!c||c===t||t?.contains(c)||!n||!t)return;i=c;const u=i.getBoundingClientRect();Object.assign(n.style,{width:`${u.width}px`,height:`${u.height}px`,top:`${u.top+window.scrollY}px`,left:`${u.left+window.scrollX}px`}),S(i,u)}function x(c){const u=new Map;if(!c||!o||!Array.isArray(o)||o.length===0)return[];const w=window.location.hostname,L=c.closest("iframe");if(L&&L.src)try{const T=new URL(L.src,window.location.href).href,z=o.find(C=>C.url===T);if(z){const C=new URL(z.url).hostname;C!==w&&u.set(C,z)}}catch{}const B=[c,...Array.from(c.querySelectorAll("*"))].map(T=>T.outerHTML).join(" ").toLowerCase();for(const T of o)if(T.status!=="blocked")try{const z=new URL(T.url).hostname;if(z===w||u.has(z))continue;if(B.includes(T.url.toLowerCase())){u.set(z,T);continue}if(z.split(".").filter(I=>I!=="www"&&I.length>3).some(I=>B.includes(I))){u.set(z,T);continue}}catch{}return Array.from(u.values())}function S(c,u){if(!t)return;const w=u.top+window.scrollY-t.offsetHeight-5,L=u.left+window.scrollX;t.style.top=`${w<0?u.bottom+window.scrollY+5:w}px`,t.style.left=`${Math.max(0,Math.min(window.innerWidth-t.offsetWidth,L))}px`;const A=window.ZenithGuardSelectorGenerator.generate(c)||"...",B=t.querySelector(".zg-hud-selector");B&&(B.textContent=A,B.title=A);const T=x(c),z=t.querySelector(".zg-hud-request-list");if(z)if(T.length>0)z.innerHTML=T.map(C=>{const I=new URL(C.url).hostname,R=C.status==="blocked";return`
                        <div class="zg-hud-request-item" title="${C.url}">
                            <span class="domain">${I}</span>
                            <button class="zg-hud-btn zg-hud-block-btn" data-domain="${I}" ${R?"disabled":""}>
                                ${R?"Blocked":"Block"}
                            </button>
                        </div>
                    `}).join("");else{const C=c.tagName.toLowerCase(),I=["button","a","input","select","textarea"].includes(C)||c.hasAttribute("onclick")||c.getAttribute("role")==="button";let R='<div class="zg-hud-no-requests">No direct network requests found for this element.</div>';I&&(R+='<div class="zg-hud-script-note">Note: Actions on this element may be handled by page-level scripts.</div>'),z.innerHTML=R}}return{start:p,stop:v}})(),window.ZenithGuardZapper=(()=>{let g=!1,e=null,n=null,t=null;const i=[];function o(d){g||(g=!0,t=d,i.length=0,l(),v())}function r(){g&&(g=!1,t=null,p(),f())}function l(){e=document.createElement("div"),e.id="zg-zapper-highlight",n=document.createElement("div"),n.id="zg-zapper-banner",n.style.cssText=`
            position: fixed; top: 0; left: 0; width: 100%; z-index: 2147483647;
            background-color: #1f2937; color: #f9fafb; padding: 10px;
            font-family: sans-serif; font-size: 14px; text-align: center;
            display: flex; justify-content: center; align-items: center; gap: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.4);
        `;const d=document.createElement("span");d.innerHTML="âš¡ <strong>Zapper Active</strong>",d.style.color="#00E5FF";const m=document.createElement("button");m.id="zg-zapper-undo-btn",m.textContent="Undo Last",m.disabled=!0,m.style.cssText=`
            background-color: #4b5563; color: white; border: 1px solid #6b7280;
            padding: 6px 12px; border-radius: 4px; cursor: pointer; font-weight: bold;
            opacity: 0.5; pointer-events: auto;
        `,m.onclick=x=>{x.preventDefault(),x.stopPropagation(),a()};const y=document.createElement("button");y.id="zg-zapper-exit-btn",y.textContent="Exit",y.style.cssText=`
            background-color: #ef4444; color: white; border: 1px solid #dc2626;
            padding: 6px 12px; border-radius: 4px; cursor: pointer; font-weight: bold;
            pointer-events: auto;
        `,y.onclick=x=>{x.preventDefault(),x.stopPropagation(),r()},n.appendChild(d),n.appendChild(m),n.appendChild(y),document.body.appendChild(e),document.body.appendChild(n)}function p(){n&&n.remove(),e&&e.remove(),e=null,n=null}function v(){document.addEventListener("mouseover",E,!0),document.addEventListener("click",b,!0),document.addEventListener("keydown",h,!0)}function f(){document.removeEventListener("mouseover",E,!0),document.removeEventListener("click",b,!0),document.removeEventListener("keydown",h,!0)}function E(d){if(!g)return;const m=d.target;if(!m||m===n||n?.contains(m)){e&&(e.style.display="none");return}const y=m.getBoundingClientRect();e&&Object.assign(e.style,{display:"block",width:`${y.width}px`,height:`${y.height}px`,top:`${y.top+window.scrollY}px`,left:`${y.left+window.scrollX}px`})}function b(d){if(!g)return;const m=d.target;if(!m||m===n||n?.contains(m)||m===e)return;d.preventDefault(),d.stopPropagation();const y=window.ZenithGuardSelectorGenerator.generate(m);y&&t?(m.style.display="none",m.classList.add("zg-zapped-temp"),t(y),i.push({element:m,selector:y}),s()):console.warn("ZenithGuard Zapper: Could not generate a unique selector.")}async function a(){if(i.length===0)return;const d=i.pop();if(!d)return;const{element:m,selector:y}=d;console.log(`ZenithGuard: Undoing zap for "${y}"`),m&&(m.style.setProperty("display","revert","important"),m.classList.remove("zg-zapped-temp"));const x=window.location.hostname,{customHidingRules:S={}}=await chrome.storage.sync.get("customHidingRules");if(S[x]){const c=S[x].length;S[x]=S[x].filter(u=>u.value!==y),S[x].length<c&&(await chrome.storage.sync.set({customHidingRules:S}),console.log("ZenithGuard: Rule removed from storage."),chrome.runtime.sendMessage({type:"REAPPLY_HIDING_RULES"}))}s()}function s(){const d=document.getElementById("zg-zapper-undo-btn");d&&(i.length>0?(d.disabled=!1,d.style.opacity="1",d.textContent=`Undo (${i.length})`):(d.disabled=!0,d.style.opacity="0.5",d.textContent="Undo"))}function h(d){g&&(d.key==="Escape"?r():(d.metaKey||d.ctrlKey)&&d.key==="z"&&(d.preventDefault(),a()))}return{start:o,stop:r}})(),window.ZenithGuardAIHider=(()=>{let g=null,e=null,n=null;function t(){if(document.getElementById("zenithguard-ai-hider-overlay"))return;if(!document.getElementById("zenithguard-theme-styles-runtime")){const h=document.createElement("link");h.id="zenithguard-theme-styles-runtime",h.rel="stylesheet",h.type="text/css",h.href=chrome.runtime.getURL("css/theme.css"),document.head.appendChild(h)}const a=document.createElement("div");a.id="zenithguard-ai-hider-overlay";const s=document.createElement("div");s.id="zenithguard-ai-hider-container",s.innerHTML=`
            <h3 id="zenithguard-ai-hider-title">Describe Element to Hide</h3>
            
            <!-- Initial Input State -->
            <div id="zenithguard-ai-hider-input-view">
                <textarea id="zenithguard-ai-hider-textarea" placeholder="e.g., 'the floating video player in the bottom corner' or 'the newsletter sign-up pop-up'"></textarea>
                <div id="zenithguard-ai-hider-actions">
                    <button id="zenithguard-ai-hider-cancel" class="zenithguard-ai-hider-btn">Cancel</button>
                    <button id="zenithguard-ai-hider-submit" class="zenithguard-ai-hider-btn">Generate Selector</button>
                </div>
            </div>

            <!-- Preview State -->
            <div id="zenithguard-ai-hider-preview-view" class="hidden">
                <input type="text" id="zenithguard-ai-hider-selector-display" readonly>
                <div id="zenithguard-ai-hider-preview-actions">
                    <button id="zenithguard-ai-hider-discard" class="zenithguard-ai-hider-btn">Discard</button>
                    <div>
                        <button id="zenithguard-ai-hider-preview-btn" class="zenithguard-ai-hider-btn zenithguard-ai-hider-preview-btn">Preview</button>
                        <button id="zenithguard-ai-hider-apply-btn" class="zenithguard-ai-hider-btn">Apply & Save</button>
                    </div>
                </div>
            </div>
            
            <!-- Error State -->
            <div id="zenithguard-ai-hider-error-view" class="hidden">
                <p id="zenithguard-ai-hider-error-message"></p>
                <button id="zenithguard-ai-hider-try-again" class="zenithguard-ai-hider-btn">Try Again</button>
            </div>
        `,a.appendChild(s),document.body.appendChild(a),e={overlay:a,container:s,title:document.getElementById("zenithguard-ai-hider-title"),inputView:document.getElementById("zenithguard-ai-hider-input-view"),previewView:document.getElementById("zenithguard-ai-hider-preview-view"),errorView:document.getElementById("zenithguard-ai-hider-error-view"),errorMessage:document.getElementById("zenithguard-ai-hider-error-message"),tryAgainBtn:document.getElementById("zenithguard-ai-hider-try-again"),textarea:document.getElementById("zenithguard-ai-hider-textarea"),submitBtn:document.getElementById("zenithguard-ai-hider-submit"),cancelBtn:document.getElementById("zenithguard-ai-hider-cancel"),selectorDisplay:document.getElementById("zenithguard-ai-hider-selector-display"),previewActions:document.getElementById("zenithguard-ai-hider-preview-actions"),discardBtn:document.getElementById("zenithguard-ai-hider-discard"),previewBtn:document.getElementById("zenithguard-ai-hider-preview-btn"),applyBtn:document.getElementById("zenithguard-ai-hider-apply-btn")},e.textarea.focus()}function i(){e&&(e.overlay&&e.overlay.remove(),chrome.runtime.sendMessage({type:"CLEAR_PREVIEW"}).catch(()=>{}),e=null,g=null,n=null)}function o(a){e&&(e.inputView.classList.add("hidden"),e.previewView.classList.add("hidden"),e.errorView.classList.add("hidden"),a==="input"?(e.title.textContent="Describe Element to Hide",e.inputView.classList.remove("hidden"),e.textarea.focus()):a==="preview"?(e.title.textContent="Generated Selector",e.previewView.classList.remove("hidden")):a==="error"&&(e.title.textContent="An Error Occurred",e.errorView.classList.remove("hidden")))}function r(a){e&&(a?(e.submitBtn.disabled=!0,e.submitBtn.innerHTML='<div class="zenithguard-ai-hider-spinner"></div><span>Generating...</span>',e.submitBtn.style.display="flex",e.submitBtn.style.alignItems="center"):(e.submitBtn.disabled=!1,e.submitBtn.innerHTML="Generate Selector"))}function l(a){if(!e)return;n=a,o("preview"),e.selectorDisplay.value=a,e.previewActions.style.display="flex",e.previewActions.style.justifyContent="space-between";const s=e.previewActions.querySelector("div");s&&(s.style.display="flex",s.style.gap="10px")}function p(a){e&&(o("error"),a==="QUOTA_EXCEEDED"?e.errorMessage.textContent="The AI is currently busy due to high demand. Please try again in a few moments.":e.errorMessage.textContent=a)}async function v(a){if(!e)return;const s=e.textarea.value.trim();if(s.length<5){p("Please provide a more detailed description.");return}r(!0);try{const h=await chrome.runtime.sendMessage({type:"HIDE_ELEMENT_WITH_AI",data:{description:s,context:a}});if(h.error)throw new Error(h.error);if(h.selector)l(h.selector);else throw new Error("AI did not return a valid selector.")}catch(h){p(h.message)}finally{r(!1)}}function f(){if(!e)return;const s={type:e.previewBtn.classList.toggle("active")?"PREVIEW_ELEMENT":"CLEAR_PREVIEW",selector:n};chrome.runtime.sendMessage(s).catch(()=>{})}function E(){n&&g&&g(n),i()}function b(a,s=null){if(!e&&(g=a,t(),e=e,!!e)){if(s&&s.tag){let h=`the ${s.tag} element`;if(s.id&&(h+=` with ID #${s.id}`),s.classes&&typeof s.classes=="string"&&s.classes.trim()){const d=s.classes.trim().replace(/\s+/g," ");h+=` with classes "${d}"`}s.text&&(h+=` containing text like "${s.text.substring(0,80)}..."`),e.textarea.value=h}e.submitBtn.addEventListener("click",()=>v(s)),e.cancelBtn.addEventListener("click",i),e.previewBtn.addEventListener("click",f),e.applyBtn.addEventListener("click",E),e.discardBtn.addEventListener("click",i),e.tryAgainBtn.addEventListener("click",()=>o("input")),e.overlay.addEventListener("click",h=>{e&&h.target===e.overlay&&i()}),document.addEventListener("keydown",h=>{h.key==="Escape"&&i()},{once:!0})}}return{start:b}})();class k{static instance;observer=null;debounceTimeout=null;reapplyCallback=null;constructor(){}static getInstance(){return k.instance||(k.instance=new k),k.instance}init(e){window.location.hostname==="www.youtube.com"&&(this.reapplyCallback=e,this.injectInterceptor(),this.hideAdElements(),this.startNuclearSkipper(),document.body?this.startObserver():window.addEventListener("DOMContentLoaded",()=>this.startObserver(),{once:!0}))}startObserver(){this.injectInterceptor(),this.hideAdElements(),this.observer=new MutationObserver(e=>{this.debounceTimeout&&clearTimeout(this.debounceTimeout),this.debounceTimeout=setTimeout(async()=>{this.reapplyCallback&&await this.reapplyCallback(!1),this.hideAdElements(),this.injectInterceptor()},200)}),document.body&&(this.observer.observe(document.body,{childList:!0,subtree:!0}),console.log("ZenithGuard: YouTube Protector Active (Modular)."))}injectInterceptor(){if(!document.getElementById("zenithguard-yt-interceptor"))try{const e=document.createElement("script");e.id="zenithguard-yt-interceptor",e.src=chrome.runtime.getURL("js/yt_interceptor.js"),console.log(`ZenithGuard: Injecting interceptor from ${e.src}`),(document.head||document.documentElement).appendChild(e),e.onload=()=>{console.log("ZenithGuard: yt_interceptor.js loaded successfully"),e.remove()},e.onerror=n=>{console.error("ZenithGuard: Failed to load yt_interceptor.js",n)}}catch(e){console.error("ZenithGuard: Error injecting yt_interceptor:",e)}}hideAdElements(){const e="zenithguard-youtube-cosmetic-styles";let n=document.getElementById(e);n||(n=document.createElement("style"),n.id=e,(document.head||document.documentElement).appendChild(n));const t=[".video-ads",".ytp-ad-player-overlay",".ytp-ad-player-overlay-layout",".ytp-ad-image-overlay",".ytp-ad-text-overlay","ytd-promoted-sparkles-web-renderer","ytd-display-ad-renderer","ytd-promoted-video-renderer","ytd-in-feed-ad-layout-renderer","ytd-ad-slot-renderer","ytd-promoted-sparkles-text-search-renderer",".ytp-ad-preview-container",".ytp-ad-overlay-container","#player-ads","#masthead-ad",".ytp-paid-content-overlay","ytd-banner-promo-renderer","ytd-action-companion-ad-renderer"],i=[".ytp-ad-skip-button",".ytp-ad-skip-button-modern",".videoAdUiSkipButton",".ytp-ad-skip-button-container",".ytp-ad-module"],o=`${t.join(", ")} { display: none !important; }`,r=`
            ${i.join(", ")} { 
                display: block !important; 
                visibility: visible !important; 
                opacity: 1 !important; 
                z-index: 2147483647 !important; 
                pointer-events: auto !important;
            }
        `;n.textContent=o+r}startNuclearSkipper(){setInterval(()=>{const e=[".ytp-ad-skip-button",".ytp-ad-skip-button-modern",".ytp-skip-ad-button",".videoAdUiSkipButton",".ytp-ad-skip-button-container button",'button[class*="skip"]'];for(const o of e){const r=document.querySelector(o);if(r&&r.offsetParent!==null){r.click(),console.log("ZenithGuard: Auto-clicked skip button");break}}const n=document.querySelector(".ytp-ad-overlay-close-button");n&&n.click();const t=document.querySelector(".html5-video-player"),i=document.querySelector("video");t&&i&&(t.classList.contains("ad-interrupting")||t.classList.contains("ad-showing")||t.classList.contains("ytp-ad-player-overlay-showing"))&&(console.log("ZenithGuard: Ad container detected. Fast-forwarding..."),i.muted=!0,i.playbackRate=16,!isNaN(i.duration)&&i.duration>0&&(i.currentTime=i.duration-.1),setTimeout(()=>{for(const r of e){const l=document.querySelector(r);l&&l.click()}},100))},25)}}class H{isBreachedSite=!1;constructor(){}setBreached(e){this.isBreachedSite=e,e&&this.showBreachWarningBanner()}attachPasswordMonitor(){document.addEventListener("focusin",e=>{const n=e.target;n&&n.tagName==="INPUT"&&n.type==="password"&&this.isBreachedSite&&this.showToast({message:"Warning: This site has a known data breach. Do not re-use an old password!",type:"error",duration:6e3})})}showBreachWarningBanner(){const e=`zg-breach-dismissed-${window.location.hostname}`;if(sessionStorage.getItem(e))return;const n=document.createElement("div");n.className="zenithguard-breach-warning",n.innerHTML=`
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.22 1.754a.75.75 0 011.56 0l4.25 8.5a.75.75 0 01-.655.996h-8.5a.75.75 0 01-.655-.996l4.25-8.5zM9 9a.75.75 0 01.75.75v2.5a.75.75 0 01-1.5 0v-2.5A.75.75 0 019 9zm0 6a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" /></svg>
            <span><strong>Security Alert:</strong> This site has a known history of data breaches. Be careful with your passwords and personal information.</span>
            <button class="z-dismiss-btn" title="Dismiss">&times;</button>
        `;const t=n.querySelector(".z-dismiss-btn");t&&t.addEventListener("click",()=>{n.remove(),sessionStorage.setItem(e,"true")}),document.body.prepend(n)}showToast(e){window.ZenithGuardToastUtils&&window.ZenithGuardToastUtils.showToast?window.ZenithGuardToastUtils.showToast(e):console.warn("ZenithGuard: Toast utility not found.")}}class M{constructor(){}aggressiveRules=new Set;observerTimeout=null;applyHidingRules(e,n){if(!e)return;const t=`zenithguard-styles-${n}`;let i=document.getElementById(t);i||(i=document.createElement("style"),i.id=t,(document.head||document.documentElement).appendChild(i));const o=[".ytp-ad-skip-button",".ytp-ad-skip-button-modern",".videoAdUiSkipButton",".ytp-ad-skip-button-container",".ytp-ad-module"],l=e.filter(p=>p.enabled&&p.value).map(p=>p.value).filter(p=>!o.some(v=>p.includes(v)));if(l.length>0){const p=l.join(", ");i.textContent=`${p}:not(#zg-zapper-highlight):not(#zg-inspector-highlight) { display: none !important; }`}else i.textContent="";n==="custom"&&(l.forEach(p=>this.aggressiveRules.add(p)),this.startAggressiveObserver(),this.enforceAggressiveFiltering())}executeAdblockWallFix(e){this.applyWallFix(e),this.showToast({message:"AI Anti-Adblock Wall activated.",type:"success",duration:6e3})}applyWallFix(e){const{overlaySelector:n,scrollSelector:t}=e;n&&(n.split(",").forEach(i=>this.aggressiveRules.add(i.trim())),t?this.unlockScroll(t):(this.unlockScroll("body"),this.unlockScroll("html")),this.startAggressiveObserver(),this.enforceAggressiveFiltering())}startAggressiveObserver(){this.wallFixObserver||(this.wallFixObserver=new MutationObserver(()=>{this.observerTimeout&&clearTimeout(this.observerTimeout),this.observerTimeout=setTimeout(()=>{this.enforceAggressiveFiltering()},100)}),this.wallFixObserver.observe(document.documentElement,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style","class","id"]}))}enforceAggressiveFiltering(){this.aggressiveRules.size!==0&&(this.ensureAggressiveStyleTag(),this.aggressiveRules.forEach(e=>{this.findEverywhere(e).forEach(t=>{const i=t,o=window.getComputedStyle(i);if(o.display!=="none"||o.visibility!=="hidden")try{i.remove(),console.log(`ZenithGuard: Physically removed "${e}"`)}catch{i.style.setProperty("display","none","important")}})}),this.unlockScroll("body"),this.unlockScroll("html"))}ensureAggressiveStyleTag(){const e="zenithguard-aggressive-styles";let n=document.getElementById(e);n?document.head&&document.head.lastElementChild!==n&&document.head.appendChild(n):(n=document.createElement("style"),n.id=e,(document.head||document.documentElement).appendChild(n));const t=Array.from(this.aggressiveRules).map(i=>`${i} { 
            display: none !important; 
            opacity: 0 !important; 
            pointer-events: none !important; 
            visibility: hidden !important; 
            z-index: -2147483647 !important;
            width: 0 !important; height: 0 !important;
            position: fixed !important; top: -10000px !important;
        }`).join(`
`);n.textContent!==t&&(n.textContent=t)}unlockScroll(e){const n=document.querySelector(e);if(n){const t=window.getComputedStyle(n);(t.overflow==="hidden"||t.position==="fixed"||t.height==="100%")&&(n.style.setProperty("overflow","visible","important"),n.style.setProperty("position","static","important"),n.style.setProperty("height","auto","important"),n.style.setProperty("pointer-events","auto","important"))}}previewElement(e,n){const t="zenithguard-preview-style";let i=document.getElementById(t);n&&e?(i||(i=document.createElement("style"),i.id=t,(document.head||document.documentElement).appendChild(i)),i.textContent=`${e} { outline: 3px dashed #d97706 !important; background-color: rgba(251, 191, 36, 0.3) !important; box-shadow: 0 0 0 9999px rgba(0,0,0,0.5); }`):i&&i.remove()}previewManualRule(e){const n="zenithguard-manual-preview-style";let t=document.getElementById(n);t&&t.remove(),t=document.createElement("style"),t.id=n,t.textContent=`
            ${e} { 
                outline: 3px solid #22c55e !important; 
                box-shadow: 0 0 15px #22c55e, 0 0 0 9999px rgba(34, 197, 94, 0.2) !important;
                transition: outline 0.3s, box-shadow 0.3s;
                border-radius: 4px;
            }
        `,(document.head||document.documentElement).appendChild(t),setTimeout(()=>{const i=document.getElementById(n);i&&i.remove()},2500)}applyIframeSandboxing(){const e=Array.from(document.querySelectorAll("iframe")),n=window.location.hostname,t="allow-scripts allow-same-origin allow-presentation allow-popups allow-forms";for(const i of e)try{i.src&&new URL(i.src).hostname!==n&&(i.hasAttribute("sandbox")||i.setAttribute("sandbox",t))}catch{}}async saveHidingRule(e){try{const n=window.location.hostname;let{customHidingRules:t={}}=await chrome.storage.sync.get("customHidingRules");t[n]||(t[n]=[]),t[n].some(i=>i.value===e)?this.showToast({message:"This hiding rule already exists."}):(t[n].push({value:e,enabled:!0}),await chrome.storage.sync.set({customHidingRules:t}),this.showToast({message:"Hiding rule saved!"}))}catch{this.showToast({message:"Failed to save rule.",type:"error"})}}wallFixObserver=null;activeWallFix=null;findEverywhere(e,n=document){if(!e||typeof e!="string"||e.trim()===""||e==="0")return[];let t=[];try{t=Array.from(n.querySelectorAll(e))}catch{return[]}const i=Array.from(n.querySelectorAll("*")).filter(o=>o.shadowRoot);for(const o of i)o.shadowRoot&&(t=t.concat(this.findEverywhere(e,o.shadowRoot)));return t}showToast(e){window.ZenithGuardToastUtils&&window.ZenithGuardToastUtils.showToast&&window.ZenithGuardToastUtils.showToast(e)}}(async()=>{const g=new H,e=new M,n=k.getInstance(),t="zg-processing-toast";let i=!1;chrome.runtime.onMessage.addListener((v,f,E)=>{const a={START_INSPECTOR_MODE:()=>window.ZenithGuardInspector.start(s=>e.saveHidingRule(s)),START_ZAPPER_MODE:()=>window.ZenithGuardZapper.start(s=>e.saveHidingRule(s)),QUICK_HIDE_ELEMENT:s=>r(s.targetElementId),START_AI_HIDING_TARGETED:s=>l(s.targetElementId),PREVIEW_ELEMENT:s=>e.previewElement(s.selector,!0),CLEAR_PREVIEW:()=>e.previewElement(null,!1),PREVIEW_MANUAL_RULE:s=>e.previewManualRule(s.selector),REAPPLY_HIDING_RULES:()=>o(!1),EXECUTE_ADBLOCK_WALL_FIX:s=>{console.log("ZenithGuard: Received EXECUTE_ADBLOCK_WALL_FIX message:",s.selectors),e.executeAdblockWallFix(s.selectors)},SHOW_PROCESSING_TOAST:s=>p({message:s.message,type:"loading",id:t,duration:0}),SHOW_ERROR_TOAST:s=>{const h=document.getElementById(t);h&&h.remove(),p({message:s.message,type:"error"})},SHOW_BREACH_WARNING:()=>g.setBreached(!0)}[v.type];return a&&(a(v),E({success:!0})),!0});async function o(v=!1){try{const f=window.location.hostname,E=await chrome.storage.sync.get(["customHidingRules","isCookieBannerHidingEnabled","isSelfHealingEnabled","isPerformanceModeEnabled","isSandboxedIframeEnabled","disabledSites","isProtectionEnabled","persistentWallFixes"]),{customHidingRules:b={},isCookieBannerHidingEnabled:a,isSelfHealingEnabled:s,isPerformanceModeEnabled:h,isSandboxedIframeEnabled:d,disabledSites:m=[],isProtectionEnabled:y=!0,persistentWallFixes:x={}}=E;if(!y||m.includes(f)){e.applyHidingRules([],"custom"),e.applyHidingRules([],"filterList"),console.log(y?"ZenithGuard: Disabled for this site.":"ZenithGuard: Global protection is OFF.");return}i=!!h;const S=b[f]||[];e.applyHidingRules(S,"custom");const c=x[f];c&&c.enabled&&(console.log(`ZenithGuard: Applying persistent Defeat Wall fix for ${f}:`,c.overlaySelector),e.applyWallFix(c)),d&&e.applyIframeSandboxing();const u=await chrome.runtime.sendMessage({type:"GET_HIDING_RULES_FOR_DOMAIN",domain:f});u&&u.rules&&e.applyHidingRules(u.rules,"filterList")}catch(f){String(f.message||f).includes("context invalidated")||console.warn("ZenithGuard: Could not re-apply hiding rules.",f)}}function r(v){const f=E=>{const b=E.target,a=window.ZenithGuardSelectorGenerator.generate(b);a&&e.saveHidingRule(a),document.removeEventListener("contextmenu",f,{capture:!0})};document.addEventListener("contextmenu",f,{once:!0,capture:!0})}function l(v){const f=E=>{const b=E.target,a={tag:b.tagName.toLowerCase(),id:b.id,classes:b.className,text:b.textContent?.trim().replace(/\s+/g," ").substring(0,200)||""};window.ZenithGuardAIHider.start(s=>e.saveHidingRule(s),a),document.removeEventListener("contextmenu",f,{capture:!0})};document.addEventListener("contextmenu",f,{once:!0,capture:!0})}const p=v=>{window.ZenithGuardToastUtils&&window.ZenithGuardToastUtils.showToast&&window.ZenithGuardToastUtils.showToast(v)};n.init(o),await o(!0),g.attachPasswordMonitor()})()})();
