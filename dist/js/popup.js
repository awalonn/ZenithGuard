import"./toast-DNfHeScJ.js";/* empty css              *//* empty css               */document.addEventListener("DOMContentLoaded",async()=>{const b=document.getElementById("power-btn"),O=document.getElementById("power-icon-enabled"),D=document.getElementById("power-icon-disabled"),Z=document.getElementById("site-hostname"),g=document.getElementById("privacy-grade-badge"),d=document.getElementById("briefing-content"),p=document.getElementById("per-site-toggle"),T=document.getElementById("ads-blocked-count"),B=document.getElementById("trackers-blocked-count"),M=document.querySelectorAll(".tab-btn"),N=document.querySelectorAll(".tab-content"),V=document.getElementById("open-settings-btn");document.getElementById("open-inspector-btn");const v=document.getElementById("isolation-mode-btn"),E=document.getElementById("forgetful-browsing-btn"),z=document.getElementById("pause-protection-btn");document.getElementById("zapper-mode-btn");const u=document.getElementById("defeat-wall-btn"),k=document.getElementById("normal-view"),A=document.getElementById("paused-view"),F=document.getElementById("resume-btn"),W=document.getElementById("pause-timer");let i,a="",l=!0,h=!1,L=null;const j={record:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9Z" /></svg>',database:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12,3C7.58,3 4,4.79 4,7V17C4,19.21 7.58,21 12,21C16.42,21 20,19.21 20,17V7C20,4.79 16.42,3 12,3M18,7C18,7.42 17.3,7.8 16.47,8.08C15.65,8.37 14.56,8.59 13.22,8.72C13.54,8.22 13.78,7.65 13.91,7.03C15.3,6.72 16.88,6.83 18,7M12,5C14.76,5 17.27,5.84 18.5,6.86C18.17,10.05 15.61,12.38 12.5,12.47C12.33,12.47 12.17,12.47 12,12.47C8.5,12.47 5.6,9.82 5.5,6.5C6.83,5.73 9.24,5 12,5M6,8.09C6.83,7.81 7.92,7.6 9.25,7.46C8.94,8 8.7,8.59 8.58,9.21C7.22,9.08 6.1,8.87 5.5,8.5C5.7,8.37 5.85,8.23 6,8.09M6,17C6,16.58 6.7,16.2 7.53,15.92C8.35,15.63 9.44,15.41 10.78,15.28C10.46,15.78 10.22,16.35 10.09,16.97C8.7,17.28 7.12,17.17 6,17M12,19C9.24,19 6.73,18.16 5.5,17.14C5.83,13.95 8.39,11.62 11.5,11.53C11.67,11.53 11.83,11.53 12,11.53C15.5,11.53 18.4,14.18 18.5,17.5C17.17,18.27 14.76,19 12,19Z" /></svg>',megaphone:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M14 3.26L10 7.26V3.26H8V7.26L4 3.26L2.6 4.67L6.6 8.67H2V10.67H6.6L2.6 14.67L4 16.08L8 12.08V16.08H10V12.08L14 16.08L15.4 14.67L11.4 10.67H22V8.67H11.4L15.4 4.67L14 3.26Z" /></svg>',shield:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1Z" /></svg>'};async function K(){if(i=(await chrome.tabs.query({active:!0,currentWindow:!0}))[0],!i||!i.url||!i.id||i.url.startsWith("chrome://")||i.url.startsWith("file://")){q();return}const{protectionPausedUntil:n}=await chrome.storage.session.get("protectionPausedUntil");if(n&&n>Date.now()){x(n);return}try{await chrome.scripting.executeScript({target:{tabId:i.id},files:["js/policy_finder.js"]})}catch(e){String(e.message).includes("Frame with ID 0 is showing error page")||String(e.message).includes("Cannot access")?console.log("ZenithGuard: Cannot inject policy finder on this page. This is expected for error pages."):console.warn("ZenithGuard: Could not inject policy finder.",e)}a=new URL(i.url).hostname,Z.textContent=a,await Promise.all([Q(),S(),Y(),J(),I(),H(),U(),R()]),ee()}function q(){const t=document.getElementById("app-root")||document.body;t.innerHTML=`
            <div class="zg-unsupported" style="padding: 20px; text-align: center; color: var(--text-secondary);">
                ZenithGuard canâ€™t run on this page (browser settings / internal pages).
            </div>
        `,document.body.style.width="300px"}async function Q(){const{disabledSites:t=[],isProtectionEnabled:n=!0}=await chrome.storage.sync.get(["disabledSites","isProtectionEnabled"]);l=n,h=t.includes(a),$(),C()}async function S(){d.innerHTML='<div class="briefing-loading">Checking for insights...</div>';const{geminiApiKey:t}=await chrome.storage.sync.get("geminiApiKey");if(!t){g.style.display="none",d.innerHTML=`
                <div class="briefing-cta-missing-key">
                    <span>AI features are disabled.</span>
                    <button id="go-to-settings-btn" class="briefing-cta-btn">Add API Key</button>
                </div>
            `;const m=document.getElementById("go-to-settings-btn");m&&m.addEventListener("click",()=>{chrome.runtime.openOptionsPage()});return}const n=`privacy-summary-${a}`,e=`privacy-policy-url-${a}`,{auditHistory:s=[],...o}=await chrome.storage.local.get(["auditHistory",n,e]),r=s.find(m=>m.domain===a),f=chrome.runtime.getURL(`src/pages/analyzer.html?tabId=${i.id}&url=${encodeURIComponent(i.url)}`);g.href=f,r?(g.textContent=r.grade,g.className=`grade-badge grade-${r.grade.toLowerCase()}`):(g.textContent="Scan",g.className="grade-badge grade-none");const y=o[n],G=o[e];if(y)if(y.error){const m=y.error.includes("QUOTA")?"AI analysis quota exceeded.":"Failed to analyze privacy policy.";d.innerHTML=`<div class="briefing-error">${c(m)}</div>`}else X(y.summary);else G?d.innerHTML=`
                <div class="briefing-cta">
                    <span>Privacy Policy found.</span>
                    <button class="briefing-summarize-btn" data-url="${c(G)}">Summarize with AI</button>
                </div>
            `:d.innerHTML='<div class="briefing-loading">No AI briefing available for this site yet.</div>'}function X(t){if(!t||!t.summary){d.innerHTML='<div class="briefing-error">Could not summarize privacy policy.</div>';return}const n=[...t.dataCollected||[],...t.sharedWith||[]].map(e=>`<span class="briefing-tag">${c(e)}</span>`).join("");d.innerHTML=`
            <p class="briefing-summary">${c(t.summary)}</p>
            <div class="briefing-tags">${n}</div>
        `}async function Y(){const t=document.getElementById("insights-list");if(t)try{const n=await chrome.runtime.sendMessage({type:"GET_PRIVACY_INSIGHTS",tabId:i.id});if(!n||n.length===0){t.innerHTML='<p class="no-items-message">No specific privacy risks detected.</p>';return}t.innerHTML=n.map(e=>`
                <div class="insight-item">
                    <div class="insight-icon type-${e.type}">${j[e.icon]||""}</div>
                    <div class="insight-message">${e.message}</div>
                </div>
            `).join("")}catch(n){console.error("ZenithGuard: Failed to load privacy insights.",n.message),t.innerHTML='<p class="no-items-message">Error loading insights.</p>'}}async function J(){const t=document.getElementById("activity");try{const n=await chrome.runtime.sendMessage({type:"GET_NETWORK_LOG",tabId:i.id});if(!Array.isArray(n)){t&&(t.innerHTML='<p class="no-items-message">Could not load activity.</p>');return}const e=n.filter(r=>r&&r.status==="blocked");T&&(T.textContent=String(e.length)),B&&(B.textContent=String(e.length));let s="";e.length===0?s='<p class="no-items-message">No requests blocked on this page yet.</p>':s=e.slice(-10).reverse().map(r=>{let f="Invalid URL";try{f=new URL(r.url).hostname}catch{console.warn("ZenithGuard: Could not parse URL from network log:",r.url)}return`
                        <div class="list-item">
                            <span class="list-item-value" title="${c(r.url)}">${f}</span>
                        </div>
                    `}).join("");const o=chrome.runtime.getURL(`src/pages/logger.html?tabId=${i.id}`);s+=`<a id="view-log-link" href="${o}" class="view-log-link" target="_blank">View Full Network Log</a>`,t&&(t.innerHTML=s)}catch(n){console.error("ZenithGuard: Failed to load activity log.",n),t&&(t.innerHTML='<p class="no-items-message">Error loading activity.</p>')}}async function I(){const t=document.getElementById("rules-list-container");if(!t)return;const{customHidingRules:n={}}=await chrome.storage.sync.get("customHidingRules"),e=n[a]||[];if(e.length===0){t.innerHTML='<p class="no-items-message">No custom hiding rules.</p>';return}t.innerHTML=e.map((s,o)=>{const r=typeof s=="string"?s:s.value;return`
            <div class="list-item">
                <span class="list-item-value" title="${c(r)}">${c(r)}</span>
                <div class="list-item-actions">
                    <button class="delete-rule-btn" data-index="${o}" aria-label="Delete rule">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                    </button>
                </div>
            </div>
        `}).join("")}async function H(){const t=document.getElementById("cookies");if(t)try{const n=await chrome.cookies.getAll({domain:a});if(n.length===0){t.innerHTML='<p class="no-items-message">No cookies found.</p>';return}t.innerHTML=n.map(e=>`
                <div class="list-item">
                    <span class="list-item-value" title="${c(e.name)}">${c(e.name)}</span>
                    <div class="list-item-actions">
                        <button class="delete-cookie-btn" data-name="${c(e.name)}" aria-label="Delete cookie">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                        </button>
                    </div>
                </div>
            `).join("")}catch(n){console.error("ZenithGuard: Error loading cookies.",n),t.innerHTML='<p class="no-items-message">Could not load cookies.</p>'}}async function U(){const{isolationModeSites:t=[]}=await chrome.storage.sync.get("isolationModeSites"),n=t.some(e=>e.enabled&&e.value===a);v&&v.classList.toggle("active",n)}async function R(){const{forgetfulSites:t=[]}=await chrome.storage.sync.get("forgetfulSites"),n=t.some(e=>e.enabled&&e.value===a);E&&E.classList.toggle("active",n)}async function w(){return i}function ee(){b.addEventListener("click",te),p.addEventListener("change",ne),M.forEach(e=>{e.addEventListener("click",()=>{const s=e,o=s.dataset.tab;o&&(M.forEach(r=>r.classList.remove("active")),N.forEach(r=>r.classList.remove("active")),s.classList.add("active"),document.getElementById(o)?.classList.add("active"))})}),V.addEventListener("click",()=>chrome.runtime.openOptionsPage()),document.getElementById("zapper-mode-btn")?.addEventListener("click",async()=>{const e=await w();e&&e.id&&chrome.tabs.sendMessage(e.id,{type:"START_ZAPPER_MODE"}),window.close()}),document.getElementById("open-inspector-btn")?.addEventListener("click",async()=>{const e=await w();e&&e.id&&chrome.tabs.sendMessage(e.id,{type:"START_INSPECTOR_MODE"}),window.close()}),document.getElementById("fix-cookies-btn")?.addEventListener("click",async()=>{const e=await w();e&&e.id&&(window.ZenithGuardToastUtils.showToast({message:"AI is looking for cookie banners...",type:"loading"}),chrome.runtime.sendMessage({type:"HANDLE_COOKIE_CONSENT_ACTION",data:{tabId:e.id}}))}),document.getElementById("privacy-grade-badge")?.addEventListener("click",async e=>{e.preventDefault();const s=await w();if(s&&s.id){const o=chrome.runtime.getURL(`src/pages/analyzer.html?tabId=${s.id}&url=${encodeURIComponent(s.url)}`);chrome.tabs.create({url:o})}}),v?.addEventListener("click",se),E?.addEventListener("click",ie),z?.addEventListener("click",de),u?.addEventListener("click",ce);const t=document.getElementById("rules-list-container");t&&t.addEventListener("click",ae);const n=document.getElementById("cookies");n&&n.addEventListener("click",oe),d.addEventListener("click",re),document.getElementById("add-rule-btn")?.addEventListener("click",le)}async function te(){l=!l,await chrome.storage.sync.set({isProtectionEnabled:l}),await chrome.runtime.sendMessage({type:"TOGGLE_GLOBAL_PROTECTION",data:{isEnabled:l}}),$(),C();const t=await chrome.tabs.query({url:["http://*/*","https://*/*"]});for(const n of t)try{n.id&&i&&n.id!==i.id&&chrome.tabs.reload(n.id)}catch{console.warn(`Could not reload tab: ${n.id}`)}i?.id&&chrome.tabs.reload(i.id),window.close()}async function ne(){h=!p.checked;const{disabledSites:t=[]}=await chrome.storage.sync.get("disabledSites");let n;h?n=[...new Set([...t,a])]:n=t.filter(e=>e!==a),await chrome.storage.sync.set({disabledSites:n}),await chrome.runtime.sendMessage({type:"APPLY_RULES_AND_RELOAD_TAB",data:{tabId:i.id}}),C(),window.close()}async function se(){let{isolationModeSites:t=[]}=await chrome.storage.sync.get("isolationModeSites");const n=t.find(s=>s.value===a);let e;n?(n.enabled=!n.enabled,e=n.enabled):(t.push({value:a,enabled:!0}),e=!0),await chrome.storage.sync.set({isolationModeSites:t}),U(),window.ZenithGuardToastUtils.showToast({message:`Isolation Mode ${e?"enabled":"disabled"}. Reload page to apply.`})}async function ie(){let{forgetfulSites:t=[]}=await chrome.storage.sync.get("forgetfulSites");const n=t.find(s=>s.value===a);let e;n?(n.enabled=!n.enabled,e=n.enabled):(t.push({value:a,enabled:!0}),e=!0),await chrome.storage.sync.set({forgetfulSites:t}),R(),window.ZenithGuardToastUtils.showToast({message:`Forgetful Browsing ${e?"enabled":"disabled"}.`})}async function ae(t){const e=t.target.closest(".delete-rule-btn");if(!e)return;const s=parseInt(e.dataset.index);let{customHidingRules:o}=await chrome.storage.sync.get("customHidingRules");o[a].splice(s,1),await chrome.storage.sync.set({customHidingRules:o}),I()}async function oe(t){const e=t.target.closest(".delete-cookie-btn");if(!e)return;const s=e.dataset.name;await chrome.cookies.remove({url:i.url,name:s}),H()}async function re(t){const e=t.target.closest(".briefing-summarize-btn");if(!e||e.disabled)return;e.disabled=!0,e.innerHTML='<div class="briefing-spinner"></div> Summarizing...';const s=e.dataset.url;try{const o=await chrome.runtime.sendMessage({type:"SUMMARIZE_PRIVACY_POLICY",data:{domain:a,policyUrl:s}});o&&o.error&&o.error==="QUOTA_EXCEEDED"&&window.ZenithGuardToastUtils.showToast({message:"AI Quota Exceeded. Please try again later.",type:"error"})}catch(o){console.error("Analysis failed:",o)}await S()}async function le(){const t=document.getElementById("add-rule-input"),n=t.value.trim();if(!n){window.ZenithGuardToastUtils.showToast({message:"Selector cannot be empty.",type:"error"});return}try{await chrome.tabs.sendMessage(i.id,{type:"PREVIEW_MANUAL_RULE",selector:n})}catch(e){console.warn("Could not send preview message, content script might not be active.",e)}try{let{customHidingRules:e={}}=await chrome.storage.sync.get("customHidingRules");e[a]||(e[a]=[]),e[a].some(s=>s.value===n)?window.ZenithGuardToastUtils.showToast({message:"This hiding rule already exists.",type:"error"}):(e[a].push({value:n,enabled:!0}),await chrome.storage.sync.set({customHidingRules:e}),window.ZenithGuardToastUtils.showToast({message:"Hiding rule added!"})),t.value="",await I()}catch(e){console.error("Failed to save hiding rule.",e),window.ZenithGuardToastUtils.showToast({message:"Failed to save rule.",type:"error"})}}async function ce(){if(!u)return;u.disabled=!0,u.classList.add("loading");let t=!1;try{const n=await chrome.runtime.sendMessage({type:"DEFEAT_ADBLOCK_WALL",data:{tabId:i.id}});if(n.error)throw new Error(n.error);if(n.selectors&&n.selectors.overlaySelector)await chrome.tabs.sendMessage(i.id,{type:"EXECUTE_ADBLOCK_WALL_FIX",selectors:n.selectors}),t=!0;else throw new Error("AI could not find a wall to defeat.")}catch(n){console.error("ZenithGuard: Adblock wall defeat failed.",n),n.message==="QUOTA_EXCEEDED"?window.ZenithGuardToastUtils.showToast({message:"AI is busy due to high demand. Please try again in a moment.",type:"error"}):window.ZenithGuardToastUtils.showToast({message:n.message,type:"error"})}finally{t?window.close():(u.classList.remove("loading"),u.disabled=!1)}}async function de(){const t=await chrome.runtime.sendMessage({type:"PAUSE_PROTECTION"});t.success&&x(t.pauseUntil)}async function P(){await chrome.runtime.sendMessage({type:"RESUME_PROTECTION"}),L&&clearInterval(L),A.style.display="none",k.style.display="block",window.close()}function x(t){k.style.display="none",A.style.display="block",_(t),L=setInterval(()=>_(t),1e3),F.addEventListener("click",P)}function _(t){const n=Math.max(0,t-Date.now());if(n===0){P();return}const e=Math.floor(n/6e4),s=Math.floor(n%6e4/1e3);W.textContent=`${e}:${s.toString().padStart(2,"0")}`}function $(){b.classList.toggle("enabled",l),b.classList.toggle("disabled",!l),O.style.display=l?"block":"none",D.style.display=l?"none":"block"}function C(){p.checked=!h,l?p.disabled=!1:p.disabled=!0}function c(t){return t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""}K()});
