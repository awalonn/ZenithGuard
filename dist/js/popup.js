import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              *//* empty css               */import{s as l}from"./toast-x-r4Mfnf.js";document.addEventListener("DOMContentLoaded",async()=>{const w=document.getElementById("power-btn"),$=document.getElementById("power-icon-enabled"),O=document.getElementById("power-icon-disabled"),F=document.getElementById("site-hostname"),b=document.getElementById("privacy-grade-badge"),p=document.getElementById("briefing-content"),y=document.getElementById("per-site-toggle"),C=document.getElementById("ads-blocked-count"),M=document.getElementById("trackers-blocked-count"),k=document.querySelectorAll(".tab-btn"),G=document.querySelectorAll(".tab-content"),N=document.getElementById("open-settings-btn");document.getElementById("open-inspector-btn");const d=document.getElementById("focus-mode-btn"),v=document.getElementById("forgetful-browsing-btn"),V=document.getElementById("pause-protection-btn");document.getElementById("zapper-mode-btn");const u=document.getElementById("defeat-wall-btn"),T=document.getElementById("normal-view"),B=document.getElementById("paused-view"),Z=document.getElementById("resume-btn"),z=document.getElementById("pause-timer");let a,r="",c=!0,h=!1,E=null;const j={record:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9Z" /></svg>',database:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12,3C7.58,3 4,4.79 4,7V17C4,19.21 7.58,21 12,21C16.42,21 20,19.21 20,17V7C20,4.79 16.42,3 12,3M18,7C18,7.42 17.3,7.8 16.47,8.08C15.65,8.37 14.56,8.59 13.22,8.72C13.54,8.22 13.78,7.65 13.91,7.03C15.3,6.72 16.88,6.83 18,7M12,5C14.76,5 17.27,5.84 18.5,6.86C18.17,10.05 15.61,12.38 12.5,12.47C12.33,12.47 12.17,12.47 12,12.47C8.5,12.47 5.6,9.82 5.5,6.5C6.83,5.73 9.24,5 12,5M6,8.09C6.83,7.81 7.92,7.6 9.25,7.46C8.94,8 8.7,8.59 8.58,9.21C7.22,9.08 6.1,8.87 5.5,8.5C5.7,8.37 5.85,8.23 6,8.09M6,17C6,16.58 6.7,16.2 7.53,15.92C8.35,15.63 9.44,15.41 10.78,15.28C10.46,15.78 10.22,16.35 10.09,16.97C8.7,17.28 7.12,17.17 6,17M12,19C9.24,19 6.73,18.16 5.5,17.14C5.83,13.95 8.39,11.62 11.5,11.53C11.67,11.53 11.83,11.53 12,11.53C15.5,11.53 18.4,14.18 18.5,17.5C17.17,18.27 14.76,19 12,19Z" /></svg>',megaphone:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M14 3.26L10 7.26V3.26H8V7.26L4 3.26L2.6 4.67L6.6 8.67H2V10.67H6.6L2.6 14.67L4 16.08L8 12.08V16.08H10V12.08L14 16.08L15.4 14.67L11.4 10.67H22V8.67H11.4L15.4 4.67L14 3.26Z" /></svg>',shield:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1Z" /></svg>'};async function W(){if(a=(await chrome.tabs.query({active:!0,currentWindow:!0}))[0],!a||!a.url||!a.id||a.url.startsWith("chrome://")||a.url.startsWith("file://")){q();return}const{protectionPausedUntil:t}=await chrome.storage.session.get("protectionPausedUntil");if(t&&t>Date.now()){U(t);return}try{await chrome.scripting.executeScript({target:{tabId:a.id},files:["js/policy_finder.js"]})}catch(e){String(e.message).includes("Frame with ID 0 is showing error page")||String(e.message).includes("Cannot access")?console.log("ZenithGuard: Cannot inject policy finder on this page. This is expected for error pages."):console.warn("ZenithGuard: Could not inject policy finder.",e)}r=new URL(a.url).hostname,F.textContent=r,await Promise.all([Y(),S(),Q(),X(),L(),A(),x(),H(),R()]),J()}function q(){const s=document.getElementById("app-root")||document.body;s.innerHTML=`
            <div class="zg-unsupported" style="padding: 20px; text-align: center; color: var(--text-secondary);">
                ZenithGuard canâ€™t run on this page (browser settings / internal pages).
            </div>
        `,document.body.style.width="300px"}async function Y(){const{disabledSites:s=[],isProtectionEnabled:t=!0}=await chrome.storage.sync.get(["disabledSites","isProtectionEnabled"]);c=t,h=s.includes(r),D(),I()}async function S(){p.innerHTML='<div class="briefing-loading">Analyzing privacy score...</div>';try{const s=await chrome.runtime.sendMessage({type:"GET_PRIVACY_STATS",tabId:a.id});s?K(s):p.innerHTML='<div class="briefing-error">No data available.</div>'}catch(s){console.error("Failed to load privacy stats",s),p.innerHTML='<div class="briefing-error">Analysis failed.</div>'}}function K(s){const{grade:t,score:e,trackersBlocked:n,trackersFound:o}=s;b&&(b.textContent=t,b.className=`grade-badge grade-${t.toLowerCase()}`);const i=e>80?"text-success":e>50?"text-warning":"text-danger";p.innerHTML=`
            <div class="privacy-score-container">
                <div class="score-circle ${t.toLowerCase()}">
                    <span class="score-value">${e}</span>
                    <span class="score-label">Score</span>
                </div>
                <div class="score-details">
                    <p class="score-summary ${i}">
                        This site is <strong>${t==="A"?"Safe":"Tracking You"}</strong>.
                    </p>
                    <p class="score-sub">Blocked ${n} potential threats.</p>
                </div>
            </div>
        `}async function Q(){const s=document.getElementById("insights-list");if(s)try{const t=await chrome.runtime.sendMessage({type:"GET_PRIVACY_INSIGHTS",tabId:a.id});if(!t||t.length===0){s.innerHTML='<p class="no-items-message">No specific privacy risks detected.</p>';return}s.innerHTML=t.map(e=>`
                <div class="insight-item">
                    <div class="insight-icon type-${e.type}">${j[e.icon]||""}</div>
                    <div class="insight-message">${e.message}</div>
                </div>
            `).join("")}catch(t){console.error("ZenithGuard: Failed to load privacy insights.",t.message),s.innerHTML='<p class="no-items-message">Error loading insights.</p>'}}async function X(){const s=document.getElementById("activity");try{const t=await chrome.runtime.sendMessage({type:"GET_NETWORK_LOG",tabId:a.id});if(!Array.isArray(t)){s&&(s.innerHTML='<p class="no-items-message">Could not load activity.</p>');return}const e=t.filter(i=>i&&i.status==="blocked");C&&(C.textContent=String(e.length)),M&&(M.textContent=String(e.length));let n="";e.length===0?n='<p class="no-items-message">No requests blocked on this page yet.</p>':n=e.slice(-10).reverse().map(i=>{let m="Invalid URL";try{m=new URL(i.url).hostname}catch{console.warn("ZenithGuard: Could not parse URL from network log:",i.url)}return`
                        <div class="list-item">
                            <span class="list-item-value" title="${g(i.url)}">${m}</span>
                        </div>
                    `}).join("");const o=chrome.runtime.getURL(`src/pages/logger.html?tabId=${a.id}`);n+=`<a id="view-log-link" href="${o}" class="view-log-link" target="_blank">View Full Network Log</a>`,s&&(s.innerHTML=n)}catch(t){console.error("ZenithGuard: Failed to load activity log.",t),s&&(s.innerHTML='<p class="no-items-message">Error loading activity.</p>')}}async function L(){const s=document.getElementById("rules-list-container");if(!s)return;const{customHidingRules:t={}}=await chrome.storage.sync.get("customHidingRules"),e=t[r]||[];if(e.length===0){s.innerHTML='<p class="no-items-message">No custom hiding rules.</p>';return}s.innerHTML=e.map((n,o)=>{const i=typeof n=="string"?n:n.value;return`
            <div class="list-item">
                <span class="list-item-value" title="${g(i)}">${g(i)}</span>
                <div class="list-item-actions">
                    <button class="delete-rule-btn" data-index="${o}" aria-label="Delete rule">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                    </button>
                </div>
            </div>
        `}).join("")}async function A(){const s=document.getElementById("cookies");if(s)try{const t=await chrome.cookies.getAll({domain:r});if(t.length===0){s.innerHTML='<p class="no-items-message">No cookies found.</p>';return}s.innerHTML=t.map(e=>`
                <div class="list-item">
                    <span class="list-item-value" title="${g(e.name)}">${g(e.name)}</span>
                    <div class="list-item-actions">
                        <button class="delete-cookie-btn" data-name="${g(e.name)}" aria-label="Delete cookie">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                        </button>
                    </div>
                </div>
            `).join("")}catch(t){console.error("ZenithGuard: Error loading cookies.",t),s.innerHTML='<p class="no-items-message">Could not load cookies.</p>'}}async function x(){const s=await chrome.storage.sync.get(["isFocusModeEnabled","focusModeUntil"]),{isFocusModeEnabled:t,focusModeUntil:e}=s,n=()=>{if(t&&e&&e>Date.now()){d.classList.add("active");const o=Math.ceil((e-Date.now())/6e4);d.querySelector("span").textContent=`Focusing (${o}m)`,d.style.border="",d.style.background=""}else d.classList.remove("active"),d.querySelector("span").textContent="Focus Mode",d.style.border="",d.style.background=""};n(),window.focusInterval&&clearInterval(window.focusInterval),window.focusInterval=setInterval(n,6e4),d.onclick=async()=>{if((await chrome.storage.sync.get("isFocusModeEnabled")).isFocusModeEnabled)await chrome.storage.sync.set({isFocusModeEnabled:!1,focusModeUntil:0}),window.ZenithGuardToastUtils.showToast({message:"Focus Mode Stopped",type:"info"});else{const m=Date.now()+15e5;await chrome.storage.sync.set({isFocusModeEnabled:!0,focusModeUntil:m}),window.ZenithGuardToastUtils.showToast({message:"Focus Mode Started (25m)",type:"success"})}setTimeout(()=>x(),100)}}async function H(){const{forgetfulSites:s=[]}=await chrome.storage.sync.get("forgetfulSites"),t=s.some(e=>e.enabled&&e.value===r);v&&v.classList.toggle("active",t)}async function f(){return a}function J(){w.addEventListener("click",ee),y.addEventListener("change",te),k.forEach(e=>{e.addEventListener("click",()=>{const n=e,o=n.dataset.tab;o&&(k.forEach(i=>i.classList.remove("active")),G.forEach(i=>i.classList.remove("active")),n.classList.add("active"),document.getElementById(o)?.classList.add("active"))})}),N.addEventListener("click",()=>chrome.runtime.openOptionsPage()),document.getElementById("zapper-mode-btn")?.addEventListener("click",async()=>{const e=await f();e&&e.id&&chrome.tabs.sendMessage(e.id,{type:"START_ZAPPER_MODE"}),window.close()}),document.getElementById("open-inspector-btn")?.addEventListener("click",async()=>{const e=await f();e&&e.id&&chrome.tabs.sendMessage(e.id,{type:"START_INSPECTOR_MODE"}),window.close()}),document.getElementById("fix-cookies-btn")?.addEventListener("click",async()=>{const e=await f();e&&e.id&&(l({message:"AI is looking for cookie banners...",type:"loading"}),chrome.runtime.sendMessage({type:"HANDLE_COOKIE_CONSENT_ACTION",data:{tabId:e.id}}))}),document.getElementById("privacy-grade-badge")?.addEventListener("click",async e=>{e.preventDefault();const n=await f();if(n&&n.id){const o=chrome.runtime.getURL(`src/pages/analyzer.html?tabId=${n.id}&url=${encodeURIComponent(n.url)}`);chrome.tabs.create({url:o})}}),v?.addEventListener("click",se),V?.addEventListener("click",ce),u?.addEventListener("click",re);const s=document.getElementById("rules-list-container");s&&s.addEventListener("click",ne);const t=document.getElementById("cookies");t&&t.addEventListener("click",oe),p.addEventListener("click",ae),document.getElementById("add-rule-btn")?.addEventListener("click",ie)}async function R(){const s=document.getElementById("isolation-mode-btn");if(!s)return;const{isolationModeSites:t=[]}=await chrome.storage.sync.get("isolationModeSites"),e=t.some(n=>n.enabled&&n.value===r);s.classList.toggle("active",e),s.onclick=async()=>{let{isolationModeSites:n=[]}=await chrome.storage.sync.get("isolationModeSites");const o=n.findIndex(m=>m.value===r);let i=!1;o>=0?(n[o].enabled=!n[o].enabled,i=n[o].enabled):(n.push({value:r,enabled:!0}),i=!0),await chrome.storage.sync.set({isolationModeSites:n}),window.ZenithGuardToastUtils.showToast({message:`Isolation Mode ${i?"enabled":"disabled"}. Reloading...`}),a&&a.id&&chrome.tabs.reload(a.id),R()}}async function ee(){c=!c,await chrome.storage.sync.set({isProtectionEnabled:c}),await chrome.runtime.sendMessage({type:"TOGGLE_GLOBAL_PROTECTION",data:{isEnabled:c}}),D(),I();const s=await chrome.tabs.query({url:["http://*/*","https://*/*"]});for(const t of s)try{t.id&&a&&t.id!==a.id&&chrome.tabs.reload(t.id)}catch{console.warn(`Could not reload tab: ${t.id}`)}a?.id&&chrome.tabs.reload(a.id),window.close()}async function te(){h=!y.checked;const{disabledSites:s=[]}=await chrome.storage.sync.get("disabledSites");let t;h?t=[...new Set([...s,r])]:t=s.filter(e=>e!==r),await chrome.storage.sync.set({disabledSites:t}),await chrome.runtime.sendMessage({type:"APPLY_RULES_AND_RELOAD_TAB",data:{tabId:a.id}}),I(),window.close()}async function se(){let{forgetfulSites:s=[]}=await chrome.storage.sync.get("forgetfulSites");const t=s.find(n=>n.value===r);let e;t?(t.enabled=!t.enabled,e=t.enabled):(s.push({value:r,enabled:!0}),e=!0),await chrome.storage.sync.set({forgetfulSites:s}),H(),l({message:`Forgetful Browsing ${e?"enabled":"disabled"}.`})}async function ne(s){const e=s.target.closest(".delete-rule-btn");if(!e)return;const n=parseInt(e.dataset.index);let{customHidingRules:o}=await chrome.storage.sync.get("customHidingRules");o[r].splice(n,1),await chrome.storage.sync.set({customHidingRules:o}),L()}async function oe(s){const e=s.target.closest(".delete-cookie-btn");if(!e)return;const n=e.dataset.name;await chrome.cookies.remove({url:a.url,name:n}),A()}async function ae(s){const e=s.target.closest(".briefing-summarize-btn");if(!e||e.disabled)return;e.disabled=!0,e.innerHTML='<div class="briefing-spinner"></div> Summarizing...';const n=e.dataset.url;try{const o=await chrome.runtime.sendMessage({type:"SUMMARIZE_PRIVACY_POLICY",data:{domain:r,policyUrl:n}});o&&o.error&&o.error==="QUOTA_EXCEEDED"&&l({message:"AI Quota Exceeded. Please try again later.",type:"error"})}catch(o){console.error("Analysis failed:",o)}await S()}async function ie(){const s=document.getElementById("add-rule-input"),t=s.value.trim();if(!t){l({message:"Selector cannot be empty.",type:"error"});return}try{await chrome.tabs.sendMessage(a.id,{type:"PREVIEW_MANUAL_RULE",selector:t})}catch(e){console.warn("Could not send preview message, content script might not be active.",e)}try{let{customHidingRules:e={}}=await chrome.storage.sync.get("customHidingRules");e[r]||(e[r]=[]),e[r].some(n=>n.value===t)?l({message:"This hiding rule already exists.",type:"error"}):(e[r].push({value:t,enabled:!0}),await chrome.storage.sync.set({customHidingRules:e}),l({message:"Hiding rule added!"})),s.value="",await L()}catch(e){console.error("Failed to save hiding rule.",e),l({message:"Failed to save rule.",type:"error"})}}async function re(){if(!u)return;u.disabled=!0,u.classList.add("loading");let s=!1;try{const t=await chrome.runtime.sendMessage({type:"DEFEAT_ADBLOCK_WALL",data:{tabId:a.id}});if(t.error)throw new Error(t.error);if(t.selectors&&t.selectors.overlaySelector)s=!0;else throw new Error("AI could not find a wall to defeat.")}catch(t){console.error("ZenithGuard: Adblock wall defeat failed.",t),t.message==="QUOTA_EXCEEDED"?l({message:"AI is busy due to high demand. Please try again in a moment.",type:"error"}):t.message==="AI_TIMEOUT"?l({message:"The AI took too long to respond. Please try again.",type:"error"}):l({message:t.message,type:"error"})}finally{if(s){u.classList.remove("loading"),u.classList.add("success");const t=u.querySelector("span");t&&(t.textContent="Success!"),setTimeout(()=>{window.close()},1500)}else u.classList.remove("loading"),u.disabled=!1}}async function ce(){const s=await chrome.runtime.sendMessage({type:"PAUSE_PROTECTION"});s.success&&U(s.pauseUntil)}async function P(){await chrome.runtime.sendMessage({type:"RESUME_PROTECTION"}),E&&clearInterval(E),B.style.display="none",T.style.display="block",window.close()}function U(s){T.style.display="none",B.style.display="block",_(s),E=setInterval(()=>_(s),1e3),Z.addEventListener("click",P)}function _(s){const t=Math.max(0,s-Date.now());if(t===0){P();return}const e=Math.floor(t/6e4),n=Math.floor(t%6e4/1e3);z.textContent=`${e}:${n.toString().padStart(2,"0")}`}function D(){w.classList.toggle("enabled",c),w.classList.toggle("disabled",!c),$.style.display=c?"block":"none",O.style.display=c?"none":"block"}function I(){y.checked=!h,c?y.disabled=!1:y.disabled=!0}function g(s){return s?s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""}W()});
